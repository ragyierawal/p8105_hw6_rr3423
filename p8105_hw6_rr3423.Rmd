---
title: "p8105_hw6_rr3423.Rmd"
author: "Ragyie Rawal"
output: github_document
---

```{r setup, include = FALSE}
library(tidyverse)
library(modelr)
library(mgcv)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```


## PROBLEM 1 

### Loading data for regression analysis 

```{r import_data}
# loading data
birthweight_data = read_csv("data/birthweight.csv")
```

### Checking for missing data by identifying any NA values in columns 

```{r check_NA}
# checking for NA values 
birthweight_data %>% 
  summarise(across(everything(), ~ sum(is.na(.))))
```

There are no NA values, thus no missing data in the birthweight dataset. 

### Converting numeric to factor or logical variables for regression analysis 

Determining the class of each variable in the birthweight dataset:

```{r variable_class}
# checking class of each variable
birthweight_data %>% 
  map(class)
```

All of the variables in the birthweight dataset are numeric. 

There are three numeric categorical variables in the dataset which should be converted to factor variables (based on the homework dataset description): babysex, frace, and mrace. The malform variable should be converted to a logical variable because it is corresponding to a binary choice (0 = absent or 1 = present).   

Checking the distinct categories in each variable: 

```{r distinct_categories}
# checking distinct categories for variables
birthweight_data %>% 
  distinct(babysex)

birthweight_data %>% 
  distinct(frace)

birthweight_data %>% 
  distinct(malform)

birthweight_data %>% 
  distinct(mrace)
```

The babysex variable has two distinct categories, which are consistent with the homework data description. The frace variable only has five distinct categories, which are not consistent with the homework data description (category 9 'unknown' is not included in this dataset). The malform variable has two distinct categories, which are consistent with the homework data description. The mrace variable only has four distinct categories, which are not consistent with the homework data description (category 8 'other' is not included in this dataset). 

Converting the numeric variables to factor or logical variables to tidy the data for regression analysis: 

```{r tidy_data}
# tidying dataset for regression analysis
birthweight_df = 
  birthweight_data %>% 
  janitor::clean_names() %>% 
  mutate(
    babysex = recode(babysex, "1" = "male", "2" = "female"),
    babysex = factor(babysex, levels = c("male", "female")),
    frace = recode(frace, "1" = "White", "2" = "Black", "3" = "Asian",
                   "4" = "Puerto Rican", "8" = "Other"),
    frace = factor(frace, levels = c("White", "Black", "Asian",
                                     "Puerto Rican", "Other")),
    malform = as.logical(malform),
    mrace = recode(mrace, "1" = "White", "2" = "Black", 
                   "3" = "Asian", "4" = "Puerto Rican"),
    mrace = factor(mrace, levels = c("White", "Black", "Asian", "Puerto Rican"))
  )
```

### Describing the birthweight dataset 

```{r describing_data}
# key variables in dataset
variables_bw = 
  birthweight_df %>% 
  names()

# number of rows in dataset
rows_bw = 
  birthweight_df %>% 
  nrow()

# number of columns in dataset
columns_bw = 
  birthweight_df %>% 
  ncol()
```

The **key variables** in the birthweight dataset are `r variables_bw`. The **number of rows** in the birthweight dataset `r rows_bw`. The **number of columns** in the birthweight dataset is `r columns_bw`. 

### Proposing a regression model for birthweight 

I am hypothesizing that the following variables are factors that underly birthweight (might be predictors of birthweight): family income (fincome), gestational age in weeks (gaweeks), mother's age at delivery in years (momage), mother's race (mrace), and mother's weight gain during pregnancy in pounds (wtgain). 

Family income could affect the amount and quality of food that is available to the mother during pregnancy, thus affecting the child's birthweight. Gestational age in weeks could affect the child's birthweight because lower gestational age could mean the child is less developed with a smaller birthweight while higher gestational age could mean the child is more developed which a larger birthweight. Mother's age at delivery could affect child's birthweight as well, since older maternal age at delivery could increase risk for lower child birthweight. Mother's race could affect child's birthweight since there could be disparities in birthweight by race. Finally, mother's weight gain during pregnancy could affect child's birthweight since less weight gain for the mother might indicate lower child birthweight while more weight gain might indicate higher child birthweight. 

My proposed regression model for birthweight is: 

```{r proposed_model}
# linear regression model
fit = lm(bwt ~ fincome + gaweeks + momage + mrace + wtgain, data = birthweight_df)
```

Tidying the output of the linear regression model: 

```{r tidying_lm}
# tidying linear model output
fit %>% 
  broom::tidy() %>% 
  select(term, estimate, p.value) %>% 
  knitr::kable(digits = 3)
```

At an alpha = 0.05 significance level, the following factors are significant because they have a p-value less than 0.05 in the linear regression model output: gaweeks, momage, mraceBlack, mracePuerto Rican, and wtgain. The following factors are not significant because they have a p-value greater than 0.05: fincome and mraceAsian.

In order to further improve my proposed regression model. I will remove the fincome factor since it was not significant. Thus, my improved proposed regression model is as follows:

```{r improved_regression_model}
fit_2 = lm(bwt ~ gaweeks + momage + mrace + wtgain, data = birthweight_df)
```

Tidying the output of the improved linear regression model: 

```{r tidying_lm_2}
fit_2 %>% 
  broom::tidy() %>% 
  select(term, estimate, p.value) %>% 
  knitr::kable(digits = 3)
```

At an alpha = 0.05 significance level, the following factors are significant because they have a p-value less than 0.05 in the linear regression model output: gaweeks, momage, mraceBlack, mracePuerto Rican, and wtgain. The mraceAsian factor is not significant because the p-value is greater that 0.05, but not as much as it was in my original proposed linear model.  

### Creating a plot of model residuals against fitted values 

Adding residuals and fitted values to the birthweight dataframe and creating plot  

```{r plot}
birthweight_df %>% 
  add_residuals(fit_2) %>% 
  add_predictions(fit_2) %>% 
  ggplot(aes(x = pred, y = resid)) + 
  geom_point() +
  labs(
   title = "Plot of model residuals against fitted values",
   x = "Predicted/fitted value",
   y = "Residual"
  )
```

The residuals vs. fitted/predicted values plot is used to detect error variance (heteroscedasticity). In the ideal situation, I would like to see a random pattern with residual values that are evenly distributed around 0 with no unusual values that stand out from the random pattern. This plot based on my proposed regression model is relatively good, since there is a pretty random pattern and the residual values are relatively evenly distributed around 0. 

Thus, I will be using this improved regression model as my proposed regression model for birthweight, and I propose that the factors underlying birthweight are: gaweeks, momage, mrace, and wtgain. 

### Comparing model to two other models 

Creating and tidying output of model using length at birth and gestational age as predictors (main effects only)

```{r model_2}
# creating model using blength and gaweeks as predictors 
model_2 = lm(bwt ~ blength + gaweeks, data = birthweight_df)

model_2 %>% 
  broom::tidy() %>% 
  select(term, estimate, p.value) %>% 
  knitr::kable(digits = 3)
```

Creating and tidying output of model using head circumference, length, sex, and all interactions (including the three-way interaction) between these

```{r model_3}
model_3 = lm(bwt ~ bhead + blength + babysex + bhead*blength + bhead*babysex + blength*babysex + bhead*blength*babysex,
           data = birthweight_df)

model_3 %>% 
  broom::tidy() %>% 
  select(term, estimate, p.value) %>%  
  knitr::kable(digits = 3)
```
